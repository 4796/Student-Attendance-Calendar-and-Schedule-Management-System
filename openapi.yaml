openapi: 3.0.3
info:
  title: Evidence of Student Attendance API
  description: API for managing student attendance, schedules, and holidays.
  version: 1.0.0
servers:
  - url: /api
paths:
  /auth/login:
    post:
      summary: User Login
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [username, password]
              properties:
                username: { type: string }
                password: { type: string }
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean }
                  user:
                    type: object
                    properties:
                      id: { type: string }
                      username: { type: string }
                      role: { type: string, enum: [ADMIN, STUDENT] }
                      firstName: { type: string }
                      lastName: { type: string }
        401:
          description: Invalid credentials
  /auth/logout:
    post:
      summary: User Logout
      tags: [Auth]
      responses:
        200:
          description: OK
  /auth/register:
    post:
      summary: Student Registration
      tags: [Auth]
      requestBody:
        required: true
        content: application/json:
            schema:
              type: object
              required: [username, email, password, firstName, lastName, indexNumber, studyProgram, yearOfStudy]
              properties:
                username: { type: string }
                email: { type: string }
                password: { type: string }
                firstName: { type: string }
                lastName: { type: string }
                indexNumber: { type: string, pattern: "^\\d{4}/\\d{4}$" }
                studyProgram: { type: string }
                yearOfStudy: { type: integer, minimum: 1, maximum: 4 }
      responses:
        201:
          description: Created
        400:
          description: Validation error
  /admin/stats:
    get:
      summary: Get Admin Dashboard Stats
      tags: [Admin]
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  termsCount: { type: integer }
                  studentsCount: { type: integer }
                  groupsCount: { type: integer }
  /admin/groups:
    get:
      summary: Get all student groups
      tags: [Admin]
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id: { type: string }
                    name: { type: string }
                    studyProgram: { type: string }
                    yearOfStudy: { type: integer }
                    alphabetHalf: { type: string }
                    studentCount: { type: integer }
  /admin/holidays:
    get:
      summary: Get all holidays
      tags: [Admin]
      responses:
        200:
          description: OK
    post:
      summary: Create a new holiday
      tags: [Admin]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [date, type]
              properties:
                date: { type: string, format: date }
                type: { type: string }
      responses:
        201:
          description: Created
  /admin/holidays/{id}:
    delete:
      summary: Delete a holiday
      tags: [Admin]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses:
        200:
          description: OK
  /admin/terms:
    get:
      summary: Get all schedule terms
      tags: [Admin]
      responses:
        200:
          description: OK
    post:
      summary: Create a new schedule term
      tags: [Admin]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TermAction'
      responses:
        201:
          description: Created
  /admin/terms/{id}:
    get:
      summary: Get a single term
      tags: [Admin]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses:
        200:
          description: OK
    patch:
      summary: Update a term
      tags: [Admin]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TermAction'
      responses:
        200:
          description: OK
    delete:
      summary: Delete a term
      tags: [Admin]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses:
        200:
          description: OK
  /student/attendance:
    post:
      summary: Record student attendance
      tags: [Student]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [termId]
              properties:
                termId: { type: string }
      responses:
        200:
          description: OK
        400:
          description: Invalid data or time
  /student/current-term:
    get:
      summary: Get the current active term for the student
      tags: [Student]
      responses:
        200:
          description: OK
  /student/profile:
    get:
      summary: Get student profile data
      tags: [Student]
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  id: { type: string }
                  username: { type: string }
                  email: { type: string }
                  firstName: { type: string }
                  lastName: { type: string }
                  indexNumber: { type: string }
                  studyProgram: { type: string }
                  yearOfStudy: { type: integer }
                  pictureUrl: { type: string, nullable: true }
                  groupId: { type: string, nullable: true }
                  groupName: { type: string, nullable: true }
    patch:
      summary: Update student profile
      tags: [Student]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [username]
              properties:
                username: { type: string, minLength: 3 }
      responses:
        200:
          description: OK
        400:
          description: Validation error
        409:
          description: Username conflict
  /student/schedule:
    get:
      summary: Get the student's personal schedule
      tags: [Student]
      responses:
        200:
          description: OK
  /student/holidays:
    get:
      summary: Get all holidays (for student view)
      tags: [Student]
      responses:
        200:
          description: OK
  /cabinets:
    get:
      summary: List all cabinets
      tags: [Utility]
      responses:
        200:
          description: OK
  /subjects:
    get:
      summary: List all subjects
      tags: [Utility]
      responses:
        200:
          description: OK

components:
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: auth-token
  schemas:
    TermAction:
      type: object
      required: [dayOfWeek, startTime, endTime, type, subjectId, cabinetId, groupId]
      properties:
        dayOfWeek: { type: string, enum: [PONEDELJAK, UTORAK, SREDA, CETVRTAK, PETAK, SUBOTA, NEDELJA] }
        startTime: { type: string, pattern: "^([01]?[0-9]|2[0-3]):[0-5][0-9](:[0-5][0-9])?$" }
        endTime: { type: string, pattern: "^([01]?[0-9]|2[0-3]):[0-5][0-9](:[0-5][0-9])?$" }
        type: { type: string, enum: [PREDAVANJA, VEZBE] }
        subjectId: { type: string }
        cabinetId: { type: string }
        groupId: { type: string }
